# MCGame - MonoGame Minecraft Clone

基于MonoGame框架的类Minecraft游戏，实现了核心的体素化世界渲染和第一人称游戏体验。

## 项目特性

### 核心功能
- **区块系统**：16x16x256的区块结构，支持动态加载和卸载
- **方块类型系统**：支持多种方块类型，包括石头、草地、泥土、木头等
- **第一人称控制**：完整的WASD移动、鼠标视角、跳跃控制
- **地形生成**：简单的柏林噪声地形生成算法
- **实时渲染**：60 FPS的目标帧率，支持视锥剔除和网格合并

### 性能优化
- **区块网格合并**：将整个区块的可见面合并为单一网格，大幅减少DrawCall
- **视锥剔除**：基于球形包围盒的快速视锥剔除，避免渲染不可见区块
- **多线程处理**：异步区块生成和网格计算，避免主线程阻塞
- **对象池管理**：减少内存分配和GC压力
- **16位方块数据**：使用16位而非32位存储方块信息，节省50%内存

### 简化实现说明

本项目采用了多个简化实现来平衡性能和代码复杂度：

1. **区块网格合并渲染**
   - 原本实现：复杂的贪婪网格合并算法
   - 简化实现：合并整个区块的可见面，大幅减少DrawCall

2. **视锥剔除**
   - 原本实现：精确的AABB包围盒视锥剔除
   - 简化实现：球形包围盒 + 距离剔除，性能更好但精度略低

3. **多线程管理**
   - 原本实现：复杂的多线程管理器
   - 简化实现：使用.NET内置任务池，简化并发处理

4. **对象池**
   - 原本实现：复杂的多级对象池
   - 简化实现：简单的队列对象池，减少内存分配

5. **着色器**
   - 原本实现：复杂的多功能着色器
   - 简化实现：基础的光照和纹理着色器

## 技术栈

- **框架**：MonoGame 3.8.1
- **运行时**：.NET 9.0
- **图形API**：OpenGL 4.0 (DesktopGL)
- **着色器**：HLSL
- **开发语言**：C# 13.0

## 项目结构

```
MCGame/
├── src/
│   ├── Core/               # 核心类和游戏主循环
│   │   ├── Structures.cs   # 数据结构定义
│   │   └── MCGame.cs       # 主游戏类
│   ├── Blocks/             # 方块系统
│   │   └── BlockRegistry.cs # 方块注册表
│   ├── Chunks/             # 区块系统
│   │   ├── Chunk.cs        # 区块类
│   │   └── ChunkManager.cs # 区块管理器
│   ├── Rendering/          # 渲染系统
│   │   ├── ChunkMesh.cs    # 区块网格
│   │   ├── ChunkMesher.cs  # 网格生成器
│   │   ├── RenderPipeline.cs # 渲染管道
│   │   └── FrustumCulling.cs # 视锥剔除
│   ├── Player/             # 玩家系统
│   │   └── Player.cs       # 玩家控制
│   ├── Utils/              # 工具类
│   │   └── ObjectPool.cs   # 对象池
│   └── Shaders/            # 着色器
│       └── BasicEffect.fx  # 基础着色器
├── Content/                # 游戏资源
│   ├── Content.mgcb        # 内容管理器配置
│   └── DebugFont.spritefont # 调试字体
└── MCGame.csproj          # 项目文件
```

## 构建和运行

### 环境要求
- .NET 9.0 SDK
- MonoGame 3.8.1
- Visual Studio 2022 或其他支持C#开发的IDE

### 构建步骤
1. 克隆项目
2. 恢复NuGet包：`dotnet restore`
3. 构建项目：`dotnet build`
4. 运行游戏：`dotnet run`

### 发布
```bash
# 单文件发布
dotnet publish -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true
```

## 控制说明

### 基本控制
- **W/A/S/D**：前后左右移动
- **鼠标**：控制视角
- **空格**：跳跃
- **左Shift**：下蹲（飞行模式中下降）
- **Tab**：切换鼠标锁定
- **ESC**：退出游戏

### 调试控制
- **F3**：切换调试模式
- **F11**：切换全屏
- **+/-**：调整渲染距离
- **F**：切换飞行模式
- **R**：重新生成世界

### 交互控制
- **鼠标左键**：破坏方块（预留）
- **鼠标右键**：放置方块（预留）
- **鼠标滚轮**：切换方块类型（预留）

## 性能目标

- **帧率**：稳定60 FPS
- **DrawCall**：< 1000次/帧
- **内存使用**：< 2GB
- **加载时间**：< 100ms/区块
- **可见区块**：10-15个区块（取决于渲染距离）

## 扩展计划

### 短期目标
- [ ] 完善方块交互系统
- [ ] 添加物品栏和背包系统
- [ ] 实现昼夜循环
- [ ] 添加声音效果

### 长期目标
- [ ] 多人游戏支持
- [ ] 高级光照系统
- [ ] 水体物理模拟
- [ ] 生物和NPC系统
- [ ] 红石电路系统

## 贡献指南

1. Fork项目
2. 创建功能分支
3. 提交更改
4. 创建Pull Request

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 致谢

- MonoGame框架团队
- Minecraft原版游戏的设计理念
- 开源社区的技术支持